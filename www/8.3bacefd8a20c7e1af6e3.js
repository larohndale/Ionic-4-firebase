(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{TUkU:function(t,e,n){"use strict";n.r(e),n.d(e,"Tab2PageModule",(function(){return v}));var o=n("ofXK"),i=n("3Pt+"),r=n("tyNb"),a=n("TEn/"),s=n("a/9d"),c=n("6+PL"),u=n("iqUP"),l=n("wd/R"),d=n("fXoL"),f=n("tk/3"),h=n("UbJi"),p=function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function a(t){try{c(o.next(t))}catch(e){r(e)}}function s(t){try{c(o.throw(t))}catch(e){r(e)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((o=o.apply(t,e||[])).next())}))},b=function(t,e){var n,o,i,r,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(i=2&r[0]?o.return:r[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,r[1])).done)return i;switch(o=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,o=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){a.label=r[1];break}if(6===r[0]&&a.label<i[1]){a.label=i[1],i=r;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(r);break}i[2]&&a.ops.pop(),a.trys.pop();continue}r=e.call(t,a)}catch(s){r=[6,s],o=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}};function g(t,e){if(1&t&&(d.Lb(0,"ion-row",5),d.Lb(1,"ion-card",11),d.Jb(2,"img",12),d.Kb(),d.Kb()),2&t){var n=d.Vb();d.yb(2),d.ac("src",n.image,d.gc)}}var m=function(){return["/"]},y=[{path:"",component:function(){function t(t,e,n,o,i,r,a,s,c,u,l){this.navCtrl=t,this.loadingCtrl=e,this.toastCtrl=n,this.camera=o,this.http=i,this.router=r,this.services=a,this.actionSheetCtrl=s,this.alertCtrl=c,this.modalCtrl=u,this.firebaseCordova=l,this.text="",this.userName=""}return t.prototype.ngOnInit=function(){this.getUser()},t.prototype.getUser=function(){var t=this;this.firebaseCordova.authState.subscribe((function(e){e?(console.log("authorized user"),t.userID=e.uid,t.userName=e.displayName,console.log(t.userID),t.getProfile(t.userID)):t.router.navigateByUrl("/login")}),(function(){t.router.navigateByUrl("/login")}))},t.prototype.getProfile=function(t){return p(this,void 0,void 0,(function(){var e=this;return b(this,(function(n){return this.services.getProfile(t).subscribe((function(t){console.log(t[0].payload.doc.data()),0===t.length?(e.empty=!1,console.log("empty")):(e.empty=!0,e.item=t,e.userName=t[0].payload.doc.data().username,e.photoUrl=t[0].payload.doc.data().img)})),[2]}))}))},t.prototype.updateToken=function(t,e){u.firestore().collection("users").doc(e).set({token:t,tokenUpdate:u.firestore.FieldValue.serverTimestamp()},{merge:!0}).then((function(){console.log("token saved to cloud firestore")})).catch((function(t){console.log(t)}))},t.prototype.dismissLoading=function(){return p(this,void 0,void 0,(function(){return b(this,(function(t){return this.loading&&this.loading.dismiss(),[2]}))}))},t.prototype.addPhoto=function(){this.launchCamera()},t.prototype.launchCamera=function(){var t=this;this.camera.getPicture({quality:100,sourceType:this.camera.PictureSourceType.CAMERA,destinationType:this.camera.DestinationType.DATA_URL,encodingType:this.camera.EncodingType.PNG,mediaType:this.camera.MediaType.PICTURE,correctOrientation:!0,targetHeight:512,targetWidth:512,allowEdit:!0}).then((function(e){console.log(e),t.image="data:image/png;base64,"+e})).catch((function(t){console.log(t)}))},t.prototype.post=function(){var t=this;u.firestore().collection("posts").add({text:this.text,created:u.firestore.FieldValue.serverTimestamp(),owner:u.auth().currentUser.uid,owner_name:this.userName,owner_photo:this.photoUrl}).then((function(e){return p(t,void 0,void 0,(function(){return b(this,(function(t){switch(t.label){case 0:return console.log(e),this.image?[4,this.upload(e.id)]:[3,2];case 1:t.sent(),t.label=2;case 2:return this.text="",this.image=void 0,[4,this.toastCtrl.create({message:"Your post has been created successfully.",duration:2e3})];case 3:return t.sent().present(),this.router.navigateByUrl("/tabs/feed"),[2]}}))}))})).catch((function(t){console.log(t)}))},t.prototype.ago=function(t){var e=l(t).diff(l());return l.duration(e).humanize()},t.prototype.upload=function(t){var e=this;return new Promise((function(n,o){return p(e,void 0,void 0,(function(){var e,i,r=this;return b(this,(function(a){switch(a.label){case 0:return[4,this.loadingCtrl.create({message:"Uploading Image..."})];case 1:return a.sent().present(),e=u.storage().ref("postImages/"+t),(i=e.putString(this.image.split(",")[1],"base64")).on("state_changed",(function(t){console.log(t),r.loadingCtrl.create({message:"Uploaded "+t.bytesTransferred/t.totalBytes*100+" % ..."})}),(function(t){console.log(t)}),(function(){console.log("The upload is complete!"),i.snapshot.ref.getDownloadURL().then((function(e){u.firestore().collection("posts").doc(t).update({image:e}).then((function(){r.dismissLoading(),n()})).catch((function(t){r.dismissLoading(),o()}))})).catch((function(t){r.dismissLoading(),o()}))})),[2]}}))}))}))},t.\u0275fac=function(e){return new(e||t)(d.Ib(a.M),d.Ib(a.K),d.Ib(a.R),d.Ib(s.a),d.Ib(f.a),d.Ib(r.f),d.Ib(c.a),d.Ib(a.a),d.Ib(a.b),d.Ib(a.L),d.Ib(h.a))},t.\u0275cmp=d.Cb({type:t,selectors:[["app-tab2"]],decls:18,vars:4,consts:[["slot","start"],["slot","end"],[3,"routerLink"],["mode","ios","color","primary","slot","icon-only","name","arrow-back"],["fullscreen","","padding",""],["margin","",1,"rowStyle"],["ion-button","","icon-only","","color","primary","clear","",3,"click"],["name","images"],["type","text","placeholder","Say something...",3,"ngModel","ngModelChange"],["name","send"],["margin","","class","rowStyle",4,"ngIf"],[1,"round-corners"],[1,"round-corners",3,"src"]],template:function(t,e){1&t&&(d.Lb(0,"ion-header"),d.Lb(1,"ion-toolbar"),d.Lb(2,"ion-buttons",0),d.Jb(3,"ion-menu-button"),d.Kb(),d.Lb(4,"ion-title"),d.kc(5,"Upload"),d.Kb(),d.Lb(6,"ion-buttons",1),d.Lb(7,"ion-button",2),d.kc(8," Back "),d.Jb(9,"ion-icon",3),d.Kb(),d.Kb(),d.Kb(),d.Kb(),d.Lb(10,"ion-content",4),d.Lb(11,"ion-row",5),d.Lb(12,"button",6),d.Tb("click",(function(){return e.addPhoto()})),d.Jb(13,"ion-icon",7),d.Kb(),d.Lb(14,"ion-input",8),d.Tb("ngModelChange",(function(t){return e.text=t})),d.Kb(),d.Lb(15,"button",6),d.Tb("click",(function(){return e.post()})),d.Jb(16,"ion-icon",9),d.Kb(),d.Kb(),d.jc(17,g,3,1,"ion-row",10),d.Kb()),2&t&&(d.yb(7),d.ac("routerLink",d.cc(3,m)),d.yb(7),d.ac("ngModel",e.text),d.yb(3),d.ac("ngIf",e.image))},directives:[a.m,a.H,a.g,a.v,a.F,a.f,a.P,r.g,a.n,a.k,a.A,a.q,a.Q,i.d,i.e,o.k,a.h],styles:[""]}),t}()}],v=function(){function t(){}return t.\u0275mod=d.Gb({type:t}),t.\u0275inj=d.Fb({factory:function(e){return new(e||t)},imports:[[o.c,i.a,a.I,r.h.forChild(y)]]}),t}()}}]);