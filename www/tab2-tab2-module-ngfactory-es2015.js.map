{"version":3,"sources":["./src/app/tab2/tab2.module.ts","./src/app/tab2/tab2.page.html","./src/app/tab2/tab2.page.ts"],"names":[],"mappings":"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","file":"tab2-tab2-module-ngfactory-es2015.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { Tab2Page } from './tab2.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: Tab2Page\n  }\n];\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    RouterModule.forChild(routes)\n  ],\n  declarations: [Tab2Page]\n})\nexport class Tab2PageModule {}\n","<ion-header>\n  <ion-toolbar>\n    <ion-buttons slot=\"start\">\n      <ion-menu-button></ion-menu-button>\n    </ion-buttons>\n    <ion-title>Upload</ion-title>\n    <ion-buttons slot=\"end\">\n      <ion-button [routerLink]=\"['/']\">\n        Back\n        <ion-icon mode=\"ios\" color=\"primary\" slot=\"icon-only\" name=\"arrow-back\"></ion-icon>\n      </ion-button>\n    </ion-buttons>\n  </ion-toolbar>\n</ion-header>\n\n<ion-content fullscreen padding>\n\n  <ion-row margin class=\"rowStyle\">\n    <button ion-button icon-only color=\"primary\" clear (click)=\"addPhoto()\">\n      <ion-icon name=\"images\"></ion-icon>\n    </button>\n\n    <ion-input type=\"text\" placeholder=\"Say something...\" [(ngModel)]=\"text\"></ion-input>\n\n    <button ion-button icon-only color=\"primary\" clear (click)=\"post()\">\n      <ion-icon name=\"send\"></ion-icon>\n    </button>\n  </ion-row>\n\n  <ion-row margin class=\"rowStyle\" *ngIf=\"image\">\n\n    <ion-card class=\"round-corners\">\n      <!-- <ion-badge class=\"badge\">\n        <ion-icon name=\"close\" class=\"close-icon\" (click)=\"openAlert()\"></ion-icon>\n      </ion-badge> -->\n      <img [src]=\"image\" class=\"round-corners\">\n    </ion-card>\n  </ion-row>\n</ion-content>","import { Component, OnInit } from '@angular/core';\nimport { NavController, LoadingController, ToastController, ActionSheetController, AlertController, ModalController } from '@ionic/angular';\nimport { Camera, CameraOptions } from '@ionic-native/camera/ngx';\nimport { HttpClient } from '@angular/common/http';\nimport { Router } from '@angular/router';\nimport { ServicesService } from '../services/services.service';\nimport { AngularFireAuth } from '@angular/fire/auth';\nimport * as firebase from 'firebase';\nimport * as moment from 'moment';\n\n@Component({\n  selector: 'app-tab2',\n  templateUrl: './tab2.page.html',\n  styleUrls: ['./tab2.page.scss'],\n})\nexport class Tab2Page implements OnInit {\n  image: string;\n  userID: any;\n  photoUrl: any;\n  item: any;\n  empty: Boolean;\n  text: string = \"\";\n  userName: string = \"\";\n  public loading: HTMLIonLoadingElement;\n\n  constructor(public navCtrl: NavController, private loadingCtrl: LoadingController, private toastCtrl: ToastController, private camera: Camera, private http: HttpClient, private router: Router, private services: ServicesService, private actionSheetCtrl: ActionSheetController, private alertCtrl: AlertController, private modalCtrl: ModalController, private firebaseCordova: AngularFireAuth) { }\n\n  ngOnInit() {\n    this.getUser();\n  }\n\n  getUser() {\n    this.firebaseCordova.authState\n      .subscribe(\n        user => {\n          if (user) {\n            console.log('authorized user');\n            this.userID = user.uid;\n            this.userName = user.displayName\n            console.log(this.userID);\n            this.getProfile(this.userID);\n          } else {\n            this.router.navigateByUrl('/login');\n          }\n        },\n        () => {\n          this.router.navigateByUrl('/login');\n        }\n      );\n  }\n\n\n  async getProfile(id: any) {\n    this.services.getProfile(id).subscribe((data => {\n      console.log(data[0].payload.doc.data());\n      if (data.length === 0) {\n        this.empty = false;\n        console.log('empty');\n      } else {\n        this.empty = true;\n        this.item = data;\n        this.userName = data[0].payload.doc.data().username;\n        this.photoUrl = data[0].payload.doc.data().img\n      }\n    }));\n  }\n\n\n  updateToken(token: string, uid: string) {\n\n    firebase.firestore().collection(\"users\").doc(uid).set({\n      token: token,\n      tokenUpdate: firebase.firestore.FieldValue.serverTimestamp()\n    }, {\n      merge: true\n    }).then(() => {\n      console.log(\"token saved to cloud firestore\");\n    }).catch(err => {\n      console.log(err);\n    })\n\n  }\n\n  public async dismissLoading(): Promise<void> {\n    if (this.loading) {\n      this.loading.dismiss();\n    }\n  }\n\n  addPhoto() {\n\n    this.launchCamera();\n\n  }\n\n  launchCamera() {\n    let options: CameraOptions = {\n      quality: 100,\n      sourceType: this.camera.PictureSourceType.CAMERA,\n      destinationType: this.camera.DestinationType.DATA_URL,\n      encodingType: this.camera.EncodingType.PNG,\n      mediaType: this.camera.MediaType.PICTURE,\n      correctOrientation: true,\n      targetHeight: 512,\n      targetWidth: 512,\n      allowEdit: true\n    }\n\n    this.camera.getPicture(options).then((base64Image) => {\n      console.log(base64Image);\n\n      this.image = \"data:image/png;base64,\" + base64Image;\n\n\n    }).catch((err) => {\n      console.log(err)\n    })\n  }\n\n\n  post() {\n\n    firebase.firestore().collection(\"posts\").add({\n      text: this.text,\n      created: firebase.firestore.FieldValue.serverTimestamp(),\n      owner: firebase.auth().currentUser.uid,\n      owner_name: this.userName,\n      owner_photo: this.photoUrl,\n    }).then(async (doc) => {\n      console.log(doc)\n\n      if (this.image) {\n        await this.upload(doc.id)\n      }\n\n      this.text = \"\";\n      this.image = undefined;\n\n      (await this.toastCtrl.create({\n        message: \"Your post has been created successfully.\",\n        duration: 2000\n      })).present();\n      this.router.navigateByUrl('/tabs/feed')\n    }).catch((err) => {\n      console.log(err)\n    })\n\n  }\n\n  ago(time: any) {\n    let difference = moment(time).diff(moment());\n    return moment.duration(difference).humanize();\n  }\n  upload(name: string) {\n\n    return new Promise(async (resolve, reject) => {\n\n      let loading = this.loadingCtrl.create({\n        message: \"Uploading Image...\"\n      });\n\n      (await loading).present();\n\n      let ref = firebase.storage().ref(\"postImages/\" + name);\n\n      let uploadTask = ref.putString(this.image.split(',')[1], \"base64\");\n\n      uploadTask.on(\"state_changed\", (taskSnapshot: any) => {\n        console.log(taskSnapshot)\n        let percentage = taskSnapshot.bytesTransferred / taskSnapshot.totalBytes * 100;\n        this.loadingCtrl.create({\n          message: `Uploaded ${percentage} % ...`\n        });\n      }, (error) => {\n        console.log(error)\n      }, () => {\n        console.log(\"The upload is complete!\");\n\n\n        uploadTask.snapshot.ref.getDownloadURL().then((url) => {\n\n          firebase.firestore().collection(\"posts\").doc(name).update({\n            image: url\n          }).then(() => {\n            this.dismissLoading();\n            resolve()\n          }).catch((err) => {\n            this.dismissLoading();\n            reject()\n          })\n\n        }).catch((err) => {\n          this.dismissLoading();\n          reject()\n        })\n\n      })\n\n    })\n\n  }\n\n\n}\n"],"sourceRoot":"webpack:///"}