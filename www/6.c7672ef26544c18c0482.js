(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{xQww:function(t,e,n){"use strict";n.r(e),n.d(e,"FeedPageModule",(function(){return x}));var o=n("ofXK"),i=n("3Pt+"),r=n("tyNb"),s=n("TEn/"),c=n("a/9d"),a=n("iqUP"),u=n("wd/R"),l=n("fXoL");function d(t,e){if(1&t&&(l.Lb(0,"ion-item"),l.Jb(1,"ion-icon",6),l.Lb(2,"h2"),l.Lb(3,"small"),l.kc(4),l.Kb(),l.Kb(),l.Lb(5,"p"),l.Lb(6,"small"),l.kc(7),l.Lb(8,"i"),l.kc(9),l.Kb(),l.Kb(),l.Kb(),l.Kb()),2&t){var n=e.$implicit,o=l.Vb();l.yb(4),l.lc(n.data().text),l.yb(3),l.mc(" ",n.data().owner_name," "),l.yb(2),l.mc(" ",o.ago(n.data().created.toDate())," ago ")}}var f=function(){function t(t,e,n){var o=this;this.navCtrl=t,this.navParams=e,this.moadlCtrl=n,this.post={},this.comments=[],this.post=this.navParams.get("post"),console.log(this.post),a.firestore().collection("comments").where("post","==",this.post.id).orderBy("created","asc").get().then((function(t){o.comments=t.docs})).catch((function(t){console.log(t)}))}return t.prototype.close=function(){this.moadlCtrl.dismiss()},t.prototype.ago=function(t){return e=this,void 0,o=function(){var e;return function(t,e){var n,o,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(r){return function(c){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(i=2&r[0]?o.return:r[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,r[1])).done)return i;switch(o=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,o=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(c){r=[6,c],o=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,c])}}}(this,(function(n){return e=u(t).diff(u()),[2,u.duration(e).humanize()]}))},new((n=void 0)||(n=Promise))((function(t,i){function r(t){try{c(o.next(t))}catch(e){i(e)}}function s(t){try{c(o.throw(t))}catch(e){i(e)}}function c(e){var o;e.done?t(e.value):(o=e.value,o instanceof n?o:new n((function(t){t(o)}))).then(r,s)}c((o=o.apply(e,[])).next())}));var e,n,o},t.\u0275fac=function(e){return new(e||t)(l.Ib(s.M),l.Ib(s.N),l.Ib(s.L))},t.\u0275cmp=l.Cb({type:t,selectors:[["app-comments"]],decls:11,vars:2,consts:[["color","danger"],["end",""],["ion-button","","icon-only","","clear","",3,"click"],["name","close"],["padding",""],[4,"ngFor","ngForOf"],["item-left","","name","ios-chatbubbles-outline"]],template:function(t,e){1&t&&(l.Lb(0,"ion-header"),l.Lb(1,"ion-navbar",0),l.Lb(2,"ion-title"),l.Lb(3,"small"),l.kc(4),l.Kb(),l.Kb(),l.Lb(5,"ion-buttons",1),l.Lb(6,"button",2),l.Tb("click",(function(){return e.close()})),l.Jb(7,"ion-icon",3),l.Kb(),l.Kb(),l.Kb(),l.Kb(),l.Lb(8,"ion-content",4),l.Lb(9,"ion-list"),l.jc(10,d,10,3,"ion-item",5),l.Kb(),l.Kb()),2&t&&(l.yb(4),l.mc("",e.comments.length," people have commented."),l.yb(6),l.ac("ngForOf",e.comments))},directives:[s.m,s.F,s.g,s.n,s.k,s.t,o.j,s.r],styles:[""]}),t}(),p=n("6+PL"),h=n("tk/3"),b=n("UbJi"),m=function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function s(t){try{a(o.next(t))}catch(e){r(e)}}function c(t){try{a(o.throw(t))}catch(e){r(e)}}function a(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,c)}a((o=o.apply(t,e||[])).next())}))},g=function(t,e){var n,o,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(r){return function(c){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(i=2&r[0]?o.return:r[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,r[1])).done)return i;switch(o=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,o=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(c){r=[6,c],o=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,c])}}};function v(t,e){if(1&t&&l.Jb(0,"img",22),2&t){var n=l.Vb().$implicit;l.ac("src",n.data().owner_photo,l.gc)}}function y(t,e){1&t&&l.Jb(0,"img",23)}function w(t,e){if(1&t){var n=l.Mb();l.Lb(0,"button",24),l.Tb("click",(function(){l.fc(n);var t=l.Vb().$implicit;return l.Vb().deleteAction(t)})),l.Jb(1,"ion-icon",25),l.Kb()}}function C(t,e){if(1&t&&l.Jb(0,"img",22),2&t){var n=l.Vb().$implicit;l.ac("src",n.data().image,l.gc)}}function L(t,e){if(1&t){var n=l.Mb();l.Lb(0,"ion-card"),l.kc(1),l.Wb(2,"json"),l.Lb(3,"ion-item",8),l.Lb(4,"ion-avatar",9),l.jc(5,v,1,1,"img",10),l.jc(6,y,1,0,"img",11),l.Kb(),l.Lb(7,"p",12),l.kc(8),l.Kb(),l.Lb(9,"ion-col",13),l.jc(10,w,2,0,"button",14),l.Kb(),l.Kb(),l.jc(11,C,1,1,"img",10),l.Lb(12,"ion-card-content"),l.Lb(13,"p"),l.kc(14),l.Kb(),l.Kb(),l.Lb(15,"ion-row",15),l.Lb(16,"ion-col"),l.Lb(17,"button",16),l.Tb("click",(function(){l.fc(n);var t=e.$implicit;return l.Vb().like(t)})),l.Jb(18,"ion-icon",17),l.kc(19),l.Kb(),l.Kb(),l.Lb(20,"ion-col"),l.Lb(21,"button",18),l.Tb("click",(function(){l.fc(n);var t=e.$implicit;return l.Vb().comment(t)})),l.Jb(22,"ion-icon",19),l.kc(23),l.Kb(),l.Kb(),l.Lb(24,"ion-col"),l.Lb(25,"button",20),l.Jb(26,"ion-icon",21),l.kc(27),l.Kb(),l.Kb(),l.Kb(),l.Kb()}if(2&t){var o=e.$implicit,i=l.Vb();l.yb(1),l.mc(" ",l.Xb(2,10,o.data())," "),l.yb(4),l.ac("ngIf",o.data().owner_photo),l.yb(1),l.ac("ngIf",!o.data().owner_photo),l.yb(2),l.mc("@",o.data().owner_name,""),l.yb(2),l.ac("ngIf",i.userID===o.data().owner),l.yb(1),l.ac("ngIf",o.data().image),l.yb(3),l.mc(" ",o.data().text," "),l.yb(5),l.mc(" ",(null==o?null:o.data().likesCount)||0," "),l.yb(4),l.mc(" ",o.data().commentsCount||0," "),l.yb(4),l.mc(" ",i.ago(o.data().created.toDate())," ")}}var k=[{path:"",component:function(){function t(t,e,n,o,i,r,s,c,a,u,l){this.navCtrl=t,this.loadingCtrl=e,this.toastCtrl=n,this.camera=o,this.http=i,this.router=r,this.services=s,this.actionSheetCtrl=c,this.alertCtrl=a,this.modalCtrl=u,this.firebaseCordova=l,this.text="",this.posts=[],this.pageSize=10,this.getPosts(),this.getUser()}return t.prototype.getUser=function(){var t=this;this.firebaseCordova.authState.subscribe((function(e){e?(console.log(e),console.log("authorized user"),t.userID=e.uid,console.log(t.userID),t.getProfile(t.userID)):t.router.navigateByUrl("/login")}),(function(){t.router.navigateByUrl("/login")}))},t.prototype.getProfile=function(t){return m(this,void 0,void 0,(function(){var e=this;return g(this,(function(n){return this.services.getProfile(t).subscribe((function(t){console.log(t),0===t.length?(e.empty=!1,console.log("empty")):(e.empty=!0,e.item=t,e.userID=t[0].payload.doc.data().uid,e.photoUrl=t[0].payload.doc.data().img)})),[2]}))}))},t.prototype.updateToken=function(t,e){a.firestore().collection("users").doc(e).set({token:t,tokenUpdate:a.firestore.FieldValue.serverTimestamp()},{merge:!0}).then((function(){console.log("token saved to cloud firestore")})).catch((function(t){console.log(t)}))},t.prototype.loadPost=function(){return m(this,void 0,void 0,(function(){return g(this,(function(t){return[2,this.loadingCtrl.create({message:"Loading Feed..."})]}))}))},t.prototype.getPosts=function(){var t=this;this.posts=[],this.loadPost();var e=a.firestore().collection("posts").orderBy("created","desc").limit(this.pageSize);e.onSnapshot((function(e){e.docChanges().forEach((function(e){if("modified"==e.type)for(var n=0;n<t.posts.length;n++)t.posts[n].id==e.doc.id&&(t.posts[n]=e.doc,console.log(t.posts))}))})),e.get().then((function(e){e.forEach((function(e){t.posts.push(e)})),t.dismissLoading(),t.cursor=t.posts[t.posts.length-1],console.log(t.posts)})).catch((function(t){console.log(t)}))},t.prototype.dismissLoading=function(){return m(this,void 0,void 0,(function(){return g(this,(function(t){return this.loading&&this.loading.dismiss(),[2]}))}))},t.prototype.loadMorePosts=function(t){var e=this;setTimeout((function(){console.log("Done"),t.target.complete(),a.firestore().collection("posts").orderBy("created","desc").startAfter(e.cursor).limit(e.pageSize).get().then((function(n){n.forEach((function(t){e.posts.push(t)})),console.log(e.posts),n.size<e.pageSize?(t.target.disabled=!0,e.infiniteEvent=t):(t.target.complete(),e.cursor=e.posts[e.posts.length-1])})).catch((function(t){console.log(t)})),100==e.post.length&&(t.target.disabled=!0)}),500)},t.prototype.refresh=function(t){var e=this;this.posts=[],this.getPosts(),this.infiniteEvent&&setTimeout((function(){e.infiniteEvent.target.disabled=!0,t.target.complete()}),2e3),t.target.complete()},t.prototype.post=function(){var t=this;a.firestore().collection("posts").add({text:this.text,created:a.firestore.FieldValue.serverTimestamp(),owner:a.auth().currentUser.uid,owner_name:a.auth().currentUser.displayName,owner_photo:a.auth().currentUser.photoURL}).then((function(e){return m(t,void 0,void 0,(function(){return g(this,(function(t){switch(t.label){case 0:return console.log(e),this.image?[4,this.upload(e.id)]:[3,2];case 1:t.sent(),t.label=2;case 2:return this.text="",this.image=void 0,[4,this.toastCtrl.create({message:"Your post has been created successfully.",duration:2e3})];case 3:return t.sent().present(),this.getPosts(),[2]}}))}))})).catch((function(t){console.log(t)}))},t.prototype.ago=function(t){var e=u(t).diff(u());return u.duration(e).humanize()},t.prototype.logout=function(){var t=this;a.auth().signOut().then((function(){return m(t,void 0,void 0,(function(){return g(this,(function(t){switch(t.label){case 0:return[4,this.toastCtrl.create({message:"You have been logged out successfully.",duration:2e3})];case 1:return t.sent().present(),this.navCtrl.navigateRoot("/feed"),[2]}}))}))}))},t.prototype.addPhoto=function(){this.launchCamera()},t.prototype.launchCamera=function(){var t=this;this.camera.getPicture({quality:100,sourceType:this.camera.PictureSourceType.CAMERA,destinationType:this.camera.DestinationType.DATA_URL,encodingType:this.camera.EncodingType.PNG,mediaType:this.camera.MediaType.PICTURE,correctOrientation:!0,targetHeight:512,targetWidth:512,allowEdit:!0}).then((function(e){console.log(e),t.image="data:image/png;base64,"+e})).catch((function(t){console.log(t)}))},t.prototype.openAlert=function(){return m(this,void 0,void 0,(function(){var t=this;return g(this,(function(e){switch(e.label){case 0:return[4,this.alertCtrl.create({message:"Sure want to delete this!!!",backdropDismiss:!1,buttons:[{text:"Delete",cssClass:"secondary",handler:function(){t.image=""}},{text:"Cancel",handler:function(){console.log("Cancel")}}]})];case 1:return[4,e.sent().present()];case 2:return e.sent(),[2]}}))}))},t.prototype.upload=function(t){var e=this;return new Promise((function(n,o){return m(e,void 0,void 0,(function(){var e,i,r=this;return g(this,(function(s){switch(s.label){case 0:return[4,this.loadingCtrl.create({message:"Uploading Image..."})];case 1:return s.sent().present(),e=a.storage().ref("postImages/"+t),(i=e.putString(this.image.split(",")[1],"base64")).on("state_changed",(function(t){console.log(t),r.loadingCtrl.create({message:"Uploaded "+t.bytesTransferred/t.totalBytes*100+" % ..."})}),(function(t){console.log(t)}),(function(){console.log("The upload is complete!"),i.snapshot.ref.getDownloadURL().then((function(e){a.firestore().collection("posts").doc(t).update({image:e}).then((function(){r.dismissLoading(),n()})).catch((function(t){r.dismissLoading(),o()}))})).catch((function(t){r.dismissLoading(),o()}))})),[2]}}))}))}))},t.prototype.like=function(t){var e={postId:t.id,userId:a.auth().currentUser.uid,action:t.data().likes&&1==t.data().likes[a.auth().currentUser.uid]?"unlike":"like"};this.http.post("https://us-central1-ploonu-1c84c.cloudfunctions.net/updateLikesCount",JSON.stringify(e),{responseType:"text"}).subscribe((function(t){console.log(t)}),(function(t){console.log(t)}))},t.prototype.comment=function(t){return m(this,void 0,void 0,(function(){var e=this;return g(this,(function(n){switch(n.label){case 0:return[4,this.actionSheetCtrl.create({buttons:[{text:"View All Comments",handler:function(){e.viewAllComments(t)}},{text:"New Comment",handler:function(){e.newComment(t)}}]})];case 1:return[4,n.sent().present()];case 2:return n.sent(),[2]}}))}))},t.prototype.viewAllComments=function(t){return m(this,void 0,void 0,(function(){return g(this,(function(e){switch(e.label){case 0:return[4,this.modalCtrl.create({component:f,componentProps:{post:t}})];case 1:return[2,e.sent().present()]}}))}))},t.prototype.newComment=function(t){return m(this,void 0,void 0,(function(){var e=this;return g(this,(function(n){switch(n.label){case 0:return[4,this.alertCtrl.create({header:"New Comment",message:"Type your comment",inputs:[{name:"comment",type:"text"}],buttons:[{text:"Cancel",handler:function(){}},{text:"Post",handler:function(n){return m(e,void 0,void 0,(function(){var e=this;return g(this,(function(o){return n.comment&&a.firestore().collection("comments").add({text:n.comment,post:t.id,owner:a.auth().currentUser.uid,owner_name:a.auth().currentUser.displayName,created:a.firestore.FieldValue.serverTimestamp()}).then((function(t){return m(e,void 0,void 0,(function(){return g(this,(function(e){switch(e.label){case 0:return console.log(t),[4,this.toastCtrl.create({message:"Comment posted successfully.",duration:3e3})];case 1:return e.sent().present(),[2]}}))}))})).catch((function(t){return m(e,void 0,void 0,(function(){return g(this,(function(e){switch(e.label){case 0:return[4,this.toastCtrl.create({message:t.message,duration:3e3})];case 1:return[4,e.sent().present()];case 2:return e.sent(),[2]}}))}))})),[2]}))}))}}]})];case 1:return[4,n.sent().present()];case 2:return n.sent(),[2]}}))}))},t.prototype.deleteAction=function(t){return m(this,void 0,void 0,(function(){var e=this;return g(this,(function(n){switch(n.label){case 0:return[4,this.actionSheetCtrl.create({buttons:[{text:"Delete",handler:function(){e.delete(t)}},{text:"Cancel",handler:function(){}}]})];case 1:return[4,n.sent().present()];case 2:return n.sent(),[2]}}))}))},t.prototype.delete=function(t){return m(this,void 0,void 0,(function(){var e,n;return g(this,(function(o){switch(o.label){case 0:if(a.auth().currentUser.uid!==t.data().owner)return[3,8];e=a.firestore().collection("posts"),o.label=1;case 1:return o.trys.push([1,5,,8]),[4,e.doc(t.id).delete()];case 2:return o.sent(),[4,this.toastCtrl.create({message:"Deleted",duration:2100})];case 3:return[4,o.sent().present()];case 4:return o.sent(),this.getPosts(),[3,8];case 5:return n=o.sent(),[4,this.toastCtrl.create({message:n.message,duration:2100})];case 6:return[4,o.sent().present()];case 7:return o.sent(),[3,8];case 8:return[2]}}))}))},t.\u0275fac=function(e){return new(e||t)(l.Ib(s.M),l.Ib(s.K),l.Ib(s.R),l.Ib(c.a),l.Ib(h.a),l.Ib(r.f),l.Ib(p.a),l.Ib(s.a),l.Ib(s.b),l.Ib(s.L),l.Ib(b.a))},t.\u0275cmp=l.Cb({type:t,selectors:[["app-feed"]],viewQuery:function(t,e){var n;1&t&&l.ic(s.o,!0),2&t&&l.dc(n=l.Ub())&&(e.infiniteScroll=n.first)},decls:13,vars:1,consts:[["slot","start"],["mode","ios","color","primary"],["fullscreen",""],[3,"ionRefresh"],["pullingIcon","chevron-down-circle-outline","pullingText","Pull to refresh","refreshingSpinner","circles","refreshingText","Refreshing..."],[4,"ngFor","ngForOf"],[3,"ionInfinite"],["loadingSpinner","bubbles","loadingText","Loading..."],["color","primary"],["item-start",""],[3,"src",4,"ngIf"],["src","https://gravatar.com/avatar/dba6bae8c566f9d4041fb9cd9ada7741?d=identicon&f=y",4,"ngIf"],[1,"ion-padding-horizontal"],[1,"ion-text-end"],["ion-button","",3,"click",4,"ngIf"],[1,"bottom-bar"],["ion-button","","clear","","small","",1,"text",3,"click"],["name","thumbs-up",1,"icon"],[1,"text",3,"click"],["name","text",1,"icon"],["ion-button","","clear","","small","",1,"text"],["name","time",1,"icon"],[3,"src"],["src","https://gravatar.com/avatar/dba6bae8c566f9d4041fb9cd9ada7741?d=identicon&f=y"],["ion-button","",3,"click"],["name","trash",1,"icon"]],template:function(t,e){1&t&&(l.Lb(0,"ion-header"),l.Lb(1,"ion-toolbar"),l.Lb(2,"ion-buttons",0),l.Jb(3,"ion-menu-button"),l.Kb(),l.Lb(4,"ion-title"),l.kc(5,"Feed"),l.Kb(),l.Jb(6,"ion-title",1),l.Kb(),l.Kb(),l.Lb(7,"ion-content",2),l.Lb(8,"ion-refresher",3),l.Tb("ionRefresh",(function(t){return e.refresh(t)})),l.Jb(9,"ion-refresher-content",4),l.Kb(),l.jc(10,L,28,12,"ion-card",5),l.Lb(11,"ion-infinite-scroll",6),l.Tb("ionInfinite",(function(t){return e.loadMorePosts(t)})),l.Jb(12,"ion-infinite-scroll-content",7),l.Kb(),l.Kb()),2&t&&(l.yb(10),l.ac("ngForOf",e.posts))},directives:[s.m,s.H,s.g,s.v,s.F,s.k,s.x,s.y,o.j,s.o,s.p,s.h,s.r,s.e,o.k,s.j,s.i,s.A,s.n],pipes:[o.f],styles:["page-feed[_ngcontent-%COMP%]   .rowStyle[_ngcontent-%COMP%]{border:1px solid var(--ion-color-primary);border-radius:30px;margin-top:15px}page-feed[_ngcontent-%COMP%]   .rowStyle[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%]{margin-top:5px}page-feed[_ngcontent-%COMP%]   .bottom-bar[_ngcontent-%COMP%]{background-color:var(--ion-color-primary)}page-feed[_ngcontent-%COMP%]   .bottom-bar[_ngcontent-%COMP%]   .border-right[_ngcontent-%COMP%]{border-right:1px solid var(--ion-color-primary)}page-feed[_ngcontent-%COMP%]   .round-corners[_ngcontent-%COMP%]{border-radius:24px}.icon[_ngcontent-%COMP%]{font-size:20px;color:rgba(9,9,9,.65)}.icon[_ngcontent-%COMP%], .text[_ngcontent-%COMP%]{display:inline-block;vertical-align:middle}"]}),t}()}],x=function(){function t(){}return t.\u0275mod=l.Gb({type:t}),t.\u0275inj=l.Fb({factory:function(e){return new(e||t)},imports:[[o.c,i.a,s.I,r.h.forChild(k)]]}),t}()}}]);